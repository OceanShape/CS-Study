# DB

## 트랜잭션
데이터베이스의 상태를 변화시키기 위해 수행하는 작업의 단위

상태 변화: SQL질의를 통해 DB에 접근

작업의 단위: 많은 SQL 명령문들을 사람이 정하는 기준에 따라 정하는 것

ex) A가 B에게 얼마를 송금한다

1. A의 계좌 update

2. B의 계좌 update

이렇게 두개가 하나의 트랜잭션

두 쿼리 모두 성공해야 commit

두개 중 한개라도 실패하면 RollBack

즉, 하나의 트랜잭션을 잘 설계해야 데이터를 다룰 때 좋다

## 특징 4가지

1. 원자성

트랜잭션이 DB에 모두 반영되거나, 반영되지 않아야 한다

2. 일관성

트랜잭션의 작업 처리 결과는 항상 일관성이 있어야 한다.

3. 독립성

둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 때는, 어떤 트랜잭션도 다른 트랜잭션 연산에 끼어들 수 없다

4. 지속성

트랜잭션이 성공적으로 완료되었으면, 결과는 영구적으로 반영되어야 한다.

commit: 하나의 트랜잭션이 성공적으로 끝났고, DB가 일관성있는 상태일대 이를 알려주기 위한 연산

RollBack: 하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션의 원자성이 깨진 경우, 트랜잭션이 정상적으로 종료되지 않았을대, last consistent state로 Rollback

**상황이 주어지면 DB측면에서 어떻게 해결 할 수 있는지 대답이 가능해야함**

## 트랜잭션 관리를 위한 DBMS의 전략

1) DBMS의 구조

2) Buffer 관리 정책

### 1. DBMS의 구조
크게 2가지

1) Query processor

2) storage system

입출력 단위: 고정 길이의 page 단위로 disk에 읽거나 쓴다

저장공간: 비휘발성 저장 장치인 disk에 저장, 일부분을 memory에 저장

### 2. page buffer manager

DBMS의 storage system에 속하는 모듈 중 하나로 memory에 유지하는 page를 관리하는 모듈

buffer 관리 정책에 따라 undo 복구와 redo 복구가 요구되거나, 그렇지 않음으로 중요

즉, 트랜잭션 관리에 중요하다

### 3. undo

필요한 이유

수정된 page들이 buffer 교체 알고리즘에 따라 출력 될 수 있음

buffer 교체는 transaction과는 무관하게 buffer의 상태에 따라 결정

이로 인해 정상적으로 종료되지 않은 트랜잭션이 변경한 page들은 복구되어야 하는데 이를 undo라고 함

2개의 정책, 수정된 page를 디스크에 쓰는 시점으로 분류

1) steal

수정된 page를 언제든 disk에 쓸 수 있는 정책

대부분의 DBMS가 채택하는 buffer관리 정책

undo logging과 복구를 필요로 함

2) ~steal

수정된 page들을 EOT(end of transaction)까지는 buffer에 유지하는 정책

undo 작업 필요X but 큰 메모리 버퍼 필요


# DB 트랜잭션 질문
1. 트랜잭션에 대해 설명해 주세요

트랜잭션은 DB의 상태를 변화시키는 상태의 단위입니다.

3. 트랜잭션 격리 수준에 대해 설명해 주세요

트랜잭션에서 일관성이 없는 데이터를 허용하는 수준을 의미합니다.

5. 트랜잭션 격리 수준은 몇가지가 있나요?(4개)

첫째 레벨 0인 read uncommitted와 둘재 레벨 1인 read commited 그리고 세번째로 레벨2인 repeatable read 마지막으로 레벨3인 serializable이 있습니다.
